<!-- JSFIDDLE HTML SECTION -->
<link href="https://maps-gl.nextbillion.io/maps/api/css" rel="stylesheet" />


<div id="mainwrapper">
  <div id="map"></div>
  <div id="grid">

  </div>

</div>

<!-- JSFIDDLE CSS SECTION -->
<style>
    * {
      margin: 0;
      padding: 0;
    }
    #map {
        width: 70vw;
        height: 70vh;
      }
    #request-matrix {
      position: absolute;
      top: 10px;
      right: 0px;
      padding: 12px;
      z-index: 99;
    }

    #remove-route {
      position: absolute;
      top: 50px;
      right: 0px;
      padding: 12px;
      z-index: 99;
    }


    #mainwrapper {
      display: flex;
      flex-direction: row;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(1, auto);  
      grid-gap: 1px;
      font-family: monospace;
      font-size: x-small;
      height: 80%;
      width: 80%;
    }

    /* (B) 1 COL ON SMALL SCREENS */
    @media screen and (max-width:768px) {
      #grid {
        grid-template-columns: auto;
      }
    }

    /* (C) OPTIONAL FOR THE CELLS */
    .head,
    .cell {
      padding: 5px;
      flex-direction: column
    }

    .head {
      font-weight: bold;
      border: 1px solid #f18e8e;
      background: #ffbfbf;
    }

    .cell {
      border: 1px solid #c2ba3c;
      background: #f8ffde;
    }

</style>

<!-- JSFIDDLE JS SECTION -->
<script src="https://maps-gl.nextbillion.io/maps/api/js"></script>
<script>
(async function() {

nextbillion.setApiKey('550e8e2631b4a4232e113eceb1dda7cc')
nextbillion.setApiHost('api.nextbillion.io')

var map = new nextbillion.maps.Map(document.getElementById('map'), {
  zoom: 12,
  center: { lat: 33.99515951, lng: -81.10231327 },
})

map.on('click', (e) => {
  console.log(`A click event has occurred at ${e.lngLat}`);
  var marker = new nextbillion.maps.Marker({
    position: {lat: e.lngLat.lat, lng: e.lngLat.lng},
    map: map,
    icon: 'blue',
  });
});
map.on('dblclick', (e) => {
  console.log(`A double click event has occurred at ${e.lngLat}`);
})

async function requestDistanceMatrix(origArray, destArray) {
  var resp = await nextbillion.api.DistanceMatrix({
    origins: origArray,
    destinations: destArray,
    mode: '4w',
  });

  let gridContainer = document.getElementById("grid");
  gridContainer.style.gridTemplateColumns = `repeat(${destArray.length+1}, auto)`;
  gridContainer.innerHTML = "";

  // layout header row
  let cell = document.createElement("div");
  cell.innerHTML = '';
  cell.className = "head";
  gridContainer.appendChild(cell);
  for (let k = 0; k < destArray.length; k++) {
    let cell = document.createElement("div");
    cell.innerHTML = 'D' + (k + 1);
    cell.className = "head";
    gridContainer.appendChild(cell);
  }
  // matrix row with leading 'D'estination point
  for (let i = 0; i < origArray.length; i++) {
    for (j = 0; j < destArray.length; j++) {
      if (j == 0) {
        let cell = document.createElement("div");
        cell.innerHTML = 'O' + (i + 1);
        cell.className = "head";
        gridContainer.appendChild(cell);
      }
      let cell = document.createElement("div");
      cell.innerHTML = resp.rows[i].elements[j].duration.value + ' s' +
        '<br>' + resp.rows[i].elements[j].distance.value + ' m';
      cell.className = "cell";
      gridContainer.appendChild(cell);
    }
  }
}

var origins = {
  "coordinates": [
    [
      -81.10231327,
      33.99515951
    ],
    [
      -80.99922892,
      34.01310541
    ],
    [
      -81.06004869,
      33.96695116
    ],
    [
      -81.03118507,
      34.04186790
    ],
    [
      -81.00266507,
      33.98718234
    ]
  ]

}


var destinations = {
  "coordinates": [
    [
      -81.08238363,
      34.02706070
    ],
    [
      -80.98239181,
      34.04784699
    ],
    [
      -81.02740531,
      33.97920442
    ],
    [
      -81.05077110,
      34.02905413
    ],
    [
      -81.09303569,
      33.96666618
    ],
    [
      -80.96417841, 
      34.03506802
    ],
    [
      -80.96423215,
      34.0632313
    ]
  ]

};


var originArray = [];
var destArray = [];

Array.prototype.forEach.call(origins.coordinates, function(pt) {
  originArray.push({
    lat: pt[1],
    lng: pt[0]
  })
});

Array.prototype.forEach.call(destinations.coordinates, function(pt) {
  destArray.push({
    lat: pt[1],
    lng: pt[0]
  })
});


requestDistanceMatrix(originArray, destArray);

})()

</script>